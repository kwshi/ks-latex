\NeedsTeXFormat{LaTeX2e}

\ProvidesPackage{ks-math}[2022/01/27 math presets]

\RequirePackage{xparse}

\RequirePackage{mathtools}
\RequirePackage{cancel}
\RequirePackage{siunitx}
\RequirePackage[inline]{enumitem}

\DeclareMathOperator{\Span}{span}
\DeclareMathOperator\Image{im}
\DeclareMathOperator\Rank{rank}
\DeclareMathOperator\Nullity{null}
\DeclareMathOperator\Tr{tr}
\renewcommand{\Vec}{\mathbfit}

\DeclareMathOperator\Imaginary{Im}
\DeclareMathOperator\Imag{Im}
\DeclareMathOperator\Real{Re}
\DeclareMathOperator\Log{Log}

\DeclareMathOperator\BoundO{O}

\newcommand\Eval[1]{\left.{#1}\right\rvert}
\DeclarePairedDelimiter{\Paren}{(}{)}
\DeclarePairedDelimiter{\Brack}{[}{]}
\DeclarePairedDelimiter{\Brace}{\{}{\}}
\DeclarePairedDelimiter{\Angle}{\langle}{\rangle}
\DeclarePairedDelimiter{\Verts}{\lvert}{\rvert}
\DeclarePairedDelimiter{\VVerts}{\lVert}{\rVert}
\DeclarePairedDelimiter{\IntervalOC}{(}{]}
\DeclarePairedDelimiter{\IntervalCO}{[}{)}
\DeclarePairedDelimiter{\IntervalC}{[}{]}
\DeclarePairedDelimiter{\IntervalO}{(}{)}
\DeclarePairedDelimiter{\Floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\Ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\Abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\Norm}{\lVert}{\rVert}
\DeclarePairedDelimiter{\Inner}{\langle}{\rangle}
\DeclarePairedDelimiter{\Set}{\{}{\}}
\DeclarePairedDelimiterX{\SetComp}[2]{\{}{\}}{{#1}:{#2}} % alternative: \;\delimsize\vert\;
\DeclarePairedDelimiter{\Bra}{\langle}{\rvert}
\DeclarePairedDelimiter{\Ket}{\lvert}{\rangle}
\DeclarePairedDelimiterX{\BraKet}[2]{\langle}{\rangle}{{#1}\,\delimsize\vert\,{#2}}
\DeclarePairedDelimiterX{\KetBra}[2]{\lvert}{\rvert}{{#1}\delimsize\rangle\delimsize\langle{#2}}

\newcommand{\Diff}[1][]{\mathop{}\!\mathrm{d}^{#1}}
\newcommand{\DiffP}[1][]{\mathop{}\!\partial^{#1}}
\newcommand{\Deriv}[3][]{\frac{\Diff[#1]{#2}}{\Diff{#3}^{#1}}}
\newcommand{\DerivP}[3][]{\frac{\DiffP[#1]{#2}}{\DiffP{#3}^{#1}}}

\newcommand\Lap{\mathop{}\!\mathrm{Δ}}
\newcommand\Grad{\mathop{}\!\mathbfit{∇}}

% extra braces grouping `\underbrace`/`\overbrace` to fix spacing ("operator"
% vs. "normal" atom); see:
% - <https://tex.stackexchange.com/questions/223908/underbrace-changing-spacing-of-operators>
% - <https://tex.stackexchange.com/questions/225762/operatorname-and-mathbin-spacing>
\NewDocumentCommand\Ub{som}{{%
    \underbrace{#3}_{%
      \IfBooleanTF{#1}{\mathclap{#2}}{#2}%
    }%
}}
\NewDocumentCommand\Ob{som}{{%
    \overbrace{#3}_{%
      \IfBooleanTF{#1}{\mathclap{#2}}{#2}%
    }%
}}

\let\SS\relax
\newcommand{\NN}{\mathbb N}
\newcommand{\CC}{\mathbb C}
\newcommand{\QQ}{\mathbb Q}
\newcommand{\RR}{\mathbb R}
\newcommand{\SS}{\mathbb S}
\newcommand{\TT}{\mathbb T}
\newcommand{\VV}{\mathbb V}
\newcommand{\WW}{\mathbb W}
\newcommand{\ZZ}{\mathbb Z}

\newcommand\Complement{^\mathsf{c}}
\newcommand\Transpose{^\mathsf{T}}

\newcommand\ks@math@IffLabel[1]{\ifcase#1\or\ensuremath{⇒}\or\ensuremath{⇐}\else\fi}
\newcommand\IffLabel[1]{\ks@math@IffLabel{\value{#1}}}
\AddEnumerateCounter{\IffLabel}{\ks@math@IffLabel}{1}
\newlist{ifflist}{enumerate}{1}
\setlist[ifflist]{label=[\IffLabel*]}

\AtBeginDocument{
  %\sisetup{
  %  detect-weight,
  %  mode=math,
  %  math-rm=\mathrm,
  %  text-rm=\rmfamily,
  %  text-sf=\rmfamily,
  %  math-sf=\mathrm,
  %}

  % need to do these overwrites after begin document because unicode math does
  % most of _its_ overwrites then, see:
  % <https://github.com/wspr/unicode-math/issues/457>
  \let\Im\relax
  \let\Re\relax
  \DeclareMathOperator\Im{Im}
  \DeclareMathOperator\Re{Re}
}


